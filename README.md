# Project项目文档

成员：12310513 娄毅彬   12310519 方酉城   12310520 芮煜涵

project选择：程序员入门计算学习机

## 团队分工

娄毅彬：计算模式、学习模式、演示模式、竞赛模式、顶层模块连接；测试

方酉城：初始化、开关机；学习模式；竞赛模式；测试

芮煜涵：计算模式、计算演示模式、额外输入输出；生成样例；测试

贡献百分比：33.3%:33.3%:33.3%

## 开发计划日程安排与实施情况

Week1:

- 整体功能设计，设计用户使用流程
- 初始化、开关机
- 计算模式中每个运算逻辑
- 实现数码管扫描显示
- 实现计算模式间切换
- 设计学习模式
- 探索蜂鸣器与dip开关使用
- 实现计算模式
- 实现大模式间切换

Week2:

- 实现学习模式的数据存储

- 完成学习模式
- 实现顶层模块
- 实现计算演示模式
- 将计算模式、学习模式、计算演示模式连接到顶层模块
- 生成测试样例

Week3:

- 设计竞赛模式具体流程
- 完成对竞赛模式选手信息、题目信息的存储
- 实现竞赛模式答题流程
- 实现比赛结果显示与复核功能
- 调整信息存储中出现的问题
- 实现竞赛模式
- 将竞赛模式连接到顶层模块
- 将蜂鸣器模块连接到顶层
- 完成整个计算学习机，进行测试

----

实施情况：基本按照开发日程完成

## 系统功能列表

### 开关机及初始化功能

- **开机**
  - 按下开关机键，系统启动，进入待机状态。
- **关机**
  - 长按3秒开关机键，系统关闭。
- **初始化**
  - 系统启动时或按下重置键，所有数据初始化。
  - 初始化后：
    - 清空竞赛模式中的所有参赛选手数据。
    - 重置系统内各模式的计数器和参数。

---

### 模式切换功能

- 系统包含四种主要模式：
  1. **计算模式**：实现基本计算功能。
  2. **学习模式**：用户通过引导学习计算知识。
  3. **竞赛模式**：多用户参与的答题竞赛。
  4. **演示模式**：展示计算过程的可视化演示。
- **切换规则**
  - 开机后默认进入待机状态。
  - 模式只能从待机状态切换，模式之间不能直接跳转。

---

### 计算模式

1. **进制转换**
   - 输入8位二进制数，完成八进制、十进制、十六进制的转换，通过8个拨码开关输入。
   - 运算结果通过数码管显示，同时显示三个进制转换的结果，从左向右分别是8进制（3位），10进制（3位），16进制（2位）
2. **有符号数算术运算**
   - 输入两个有符号数，完成加减法运算，通过8个拨码开关输入。
   - 运算结果通过LED显示。
3. **移位运算**
   - 算术左移、右移，逻辑左移、右移，通过8个拨码开关输入。
   - 运算结果通过LED显示。
4. **位运算**
   - 提供按位与、或、非、异或运算，通过8个拨码开关输入。
   - 运算结果通过LED显示。
5. **逻辑运算**
   - 支持逻辑与、或、非、异或操作，通过8个拨码开关输入。
   - 运算结果通过LED显示。

---

### 学习模式

在计算模式实现的基础上，有以下功能：

1. **用户引导**
   - 用户可指定题目类型和参数，输入答案；通过8个拨码开关输入
2. **答题判定**
   - 实时判断用户输入是否正确，并使用数码管显示对错。
3. **学习数据统计**
   - 记录并显示用户的答题数量、正确率及学习数据。
   - 切换可以查看每个大的运算模式的学习情况。

---

### 竞赛模式

- **管理员功能**
  - 设置题目类型及题量，可设定参赛选手数量，支持最多4个参赛选手。
- **比赛流程**
  1. 当前题目编号及倒计时通过LED或数码管显示。
  2. 用户在限定时间内完成答题，超时自动判错。
- **比赛结果**
  - 根据正确率及答题时间，显示胜出的参赛选手。
  - 提供每位选手的答题时间、正确答案及答题记录复核功能。

---

### 计算演示模式

- **乘法计算演示**
  - 用户输入两个3位无符号数。
  - 演示步骤及结果通过LED动态显示。
- **操作选择**
  - 用户可选择重新演示或退出。

---

### 额外输入输出设备支持

- 设计了不同蜂鸣器音效，可表示答题正确、错误，模式切换，确定等音效；由3.5mm耳机接口连接耳机。
- 可以通过dip开关调节蜂鸣器音量。

## 系统使用说明

![image-20241215144853392](/Users/ruiyuhan/Library/Application Support/typora-user-images/image-20241215144853392.png)

## 系统结构说明

**系统模块概述**

本设计包括一个顶层模块 top 和多个子模块，用于实现多功能硬件系统，功能包括模式切换、信号处理、数码管和LED动态显示、蜂鸣器控制等。

​	1.	**顶层模块 (**top**)**

​	•	**功能**：管理各个子模块的协作，处理输入按钮、拨码开关等外部信号，通过模式选择来激活不同功能模块，并控制输出（数码管、LED、蜂鸣器）。

​	•	**信号输入**：时钟信号（clk）、复位信号（reset）、用户按钮（power_button、confirm、select、exit、change）、拨码开关（dip_switch）、输入信号（in）。

​	•	**信号输出**：蜂鸣器信号（pwm_out）、数码管控制信号（Seg1、Seg2、anode）、LED信号（led1、led2）。

​	•	**功能描述**：

​	•	管理系统电源状态（通过 power_button 控制待机或关机）。

​	•	通过 select 按钮切换模式（包括 cal_top、study_top、competition_top、display）。

​	•	根据 confirm 和 exit 按钮进入或退出当前模式。

​	•	动态控制蜂鸣器和数码管显示。

​	2.	**子模块功能说明**

​	•	buzzer **模块**：根据模式和输入信号控制蜂鸣器产生对应的声音信号。

​	•	cal_top **模块**：实现模式 1（计算功能），支持数码管动态显示和LED控制。

​	•	study_top **模块**：实现模式 2（学习模式），对输入信号进行处理并显示学习数据。

​	•	competition_top **模块**：实现模式 3（比赛模式），管理比赛数据，包括答题记录和选手排名。

​	•	display **模块**：实现模式 4，处理特殊数据显示任务。

​	•	display_scan **任务**：动态扫描数码管，根据当前模式和激活的信号显示对应的数值或符号。

**模块间信号关系**

​	1.	**信号输入**：

​	•	**全局时钟（**clk**）**：所有模块的时序逻辑基础时钟。

​	•	**复位信号（**reset**）**：用于系统复位，初始化所有模块。

​	•	**控制信号**：

​	•	power_button：控制电源状态的开关。

​	•	confirm：进入当前模式的确认按钮。

​	•	select：切换模式的按钮。

​	•	exit：退出当前模式的按钮。

​	•	change：用于某些模式下的附加功能。

​	•	**拨码开关输入（**dip_switch**）**：传递给 buzzer 模块，用于改变蜂鸣器音效。

​	•	**输入信号（**in**）**：传递给子模块，提供用户输入数据。

​	2.	**信号输出**：

​	•	**蜂鸣器信号（**pwm_out**）**：通过 buzzer 模块输出，控制蜂鸣器发声。

​	•	**数码管信号（**Seg1**、**Seg2**、**anode**）**：通过数码管显示对应模式的输出数据。

​	•	**LED信号（**led1**、**led2**）**：各模块根据当前状态和操作控制LED亮灭。

​	3.	**信号关系**：

​	•	顶层模块 top 通过 mode_sel 激活对应子模块，同时传递输入信号（clk、reset、confirm 等）到每个子模块。

​	•	每个子模块处理输入后，将其输出信号（seg 和 leds）反馈回顶层模块。

​	•	顶层模块根据当前模式（mode_sel）动态选择显示信号，并通过 display_scan 将其分发到数码管。

**模块间信号交互**

​	•	**模式切换与控制**：

​	•	mode_sel：顶层模块通过 select 切换模式，并激活对应的子模块。

​	•	子模块输入 enter 信号判断是否被激活。

​	•	**显示信号传递**：

​	•	各子模块将 seg 和 leds 信号反馈给顶层模块。

​	•	顶层模块根据当前模式动态分配数码管信号（Seg1、Seg2）和LED信号（led1、led2）。

​	•	**蜂鸣器控制**：

​	•	顶层模块将 sel 和 en 信号传递给 buzzer 模块，控制蜂鸣器的工作状态。

### **引脚绑定表**

#### **输入引脚**

| **信号名称**      | **位宽** | **绑定引脚**                   | **描述**               |
| ----------------- | -------- | ------------------------------ | ---------------------- |
| `clk`             | 1        | P17                            | 时钟信号               |
| `reset`           | 1        | P15                            | 复位信号               |
| `power_button`    | 1        | V1                             | 电源按钮               |
| `confirm`         | 1        | R15                            | 确认按钮               |
| `select`          | 1        | U4                             | 切换模式按钮           |
| `exit`            | 1        | R17                            | 退出按钮               |
| `change`          | 1        | R11                            | 附加功能按钮           |
| `dip_switch[7:0]` | 8        | U3, U2, V2, V5, V4, R3, T3, T5 | 拨码开关，用于音效调节 |
| `in[7:0]`         | 8        | R1, N4, M4, R2, P2, P3, P4, P5 | 用户输入数据           |

---

#### **输出引脚**

| **信号名称** | **位宽** | **绑定引脚**                   | **描述**                  |
| ------------ | -------- | ------------------------------ | ------------------------- |
| `pwm_out`    | 1        | T1                             | 蜂鸣器 PWM 输出信号       |
| `Seg1[7:0]`  | 8        | B4, A4, A3, B1, A1, B3, B2, D5 | 数码管显示信号（前 4 位） |
| `Seg2[7:0]`  | 8        | D4, E3, D3, F4, F3, E2, D2, H2 | 数码管显示信号（后 4 位） |
| `anode[7:0]` | 8        | G2, C2, C1, H1, G1, F1, E1, G6 | 数码管动态扫描控制信号    |
| `led1[7:0]`  | 8        | K2, J2, J3, H4, J4, G3, G4, F6 | LED 显示信号（第 1 组）   |
| `led2[7:0]`  | 8        | K3, M1, L1, K6, J5, H5, H6, K1 | LED 显示信号（第 2 组）   |

## 子模块功能说明

buzzer:

​	1.	**输入音效选择与占空比控制模块**

​	•	通过输入 se（音效选择信号）选择播放不同音效序列，并通过 dip_switch 调节音量（控制 PWM 占空比）。

​	2.	**PWM 波形生成模块**

​	•	根据音符频率生成 PWM 波形，结合占空比控制，实现音量的调节。

​	3.	**音符序列播放模块**

​	•	按照状态机顺序播放指定音效的音符序列，并控制每个音符的播放时长。

​	4.	**音效持续时间管理模块**

​	•	使用计数器 time_counter 控制每个音符的持续时间，并在播放完成后切换到下一个音符。

​	5.	**默认静音模块**

​	•	在停止状态或未启用的情况下，pwm_out 输出为低电平，确保扬声器不发声。

| **状态**  | **描述**                                          |
| --------- | ------------------------------------------------- |
| `S1`      | **胜利音效**：依次播放音符 `Do → Re → Mi`。       |
| `S2`      | **失败音效**：依次播放音符 `Mi → Do`。            |
| `S3`      | **切换音效**：依次播放音符 `La → Fa`。            |
| `S4`      | **结算音效**：依次播放音符 `Do → Mi → Sol → Do`。 |
| `S5`      | **备用音效 1**：依次播放音符 `Sol → Mi → Do`。    |
| `S6`      | **提示音效**：重复播放音符 `Mi`。                 |
| `Default` | **默认状态**：`PWM 输出低电平`，扬声器无声。      |

cal_top:

​	1.	**模式选择**

​	•	通过 select 按键切换运算模式：

​	•	**Type1**：进制转换

​	•	**Type2**：符号加减法

​	•	**Type3**：位移操作

​	•	**Type4**：位运算

​	•	**Type5**：逻辑运算

​	2.	**运算操作符切换**

​	•	根据模式，选择不同的操作符（加、减、移位等）。

​	3.	**输入与存储**

​	•	通过 confirm 进行运算步骤切换：输入数值 A、B 并存储，计算结果。

​	4.	**结果显示**

​	•	**数码管** (seg1 ~ seg8) 和 **LED** 显示当前运算模式、操作符及结果。

| **状态** | **描述**                                                     |
| -------- | ------------------------------------------------------------ |
| `Step1`  | **初始化状态**：清除之前的运算数据，复位存储寄存器，恢复初始状态。 |
| `Step2`  | **输入操作数 A**：用户输入操作数 `a`，数码管 `seg3` 提示输入操作数 `A`。 |
| `Step3`  | **输入操作数 B**：用户输入操作数 `b`，数码管 `seg4` 提示输入操作数 `B`。 |
| `Step4`  | **执行运算并显示结果**：根据当前模式与操作符执行运算，结果显示在数码管。 |

study_top:

​	1.	**模式选择与切换**

​	•	输入 enter 键触发进入功能模式，使用 select 切换五种运算模式（M1 ~ M5）。

​	•	mode_entered 信号指示是否进入某个功能模式。

​	2.	**学情查看功能**

​	•	通过 data 信号进入学情统计模式。

​	•	学情显示统计每个模式的题目数量和正确率，切换查看不同模式的数据（DM1 ~ DM5）。

​	3.	**操作符切换**

​	•	进入模式后，通过 select 切换操作符（OP1 ~ OP4），不同模式下操作符功能不同。

​	4.	**用户输入与结果存储**

​	•	用户在 Step2 和 Step3 步骤中输入两个操作数 a 和 b。

​	•	存储用户的输入值，进行运算并存储正确答案。

​	5.	**运算功能**

​	•	根据当前模式和操作符，调用不同的 task 进行运算：

​	•	**M1**: 进制转换（八进制、十进制、十六进制）

​	•	**M2**: 加减法运算（有符号操作）

​	•	**M3**: 移位操作（逻辑和算术移位）

​	•	**M4**: 位运算（与、或、非、异或）

​	•	**M5**: 逻辑运算（逻辑与、或、非、异或）

​	6.	**结果验证与显示**

​	•	比较用户输入与标准答案，使用 correct 信号指示答案正确与否。

​	•	记录正确率和题目数量，数码管 seg1 ~ seg8 输出模式编号、正确率与结果。

​	7.	**状态控制**

​	•	使用状态机控制存储、验证和显示步骤：Step1 ~ Step6。

| **状态** | **描述**                                                 |
| -------- | -------------------------------------------------------- |
| `Step1`  | 清除之前的数据，进入新一轮的操作                         |
| `Step2`  | 输入第一个操作数 `a` 并存储到寄存器                      |
| `Step3`  | 输入第二个操作数 `b` 并存储到寄存器                      |
| `Step4`  | 运算结果并存储正确答案                                   |
| `Step5`  | 等待用户输入结果并与正确答案进行比较                     |
| `Step6`  | 输出答案正确或错误状态，并更新题目数量与正确题目数量统计 |

display:

​	1.	**按钮延迟控制模块**

​	•	对 confirm 和 exit 按钮信号进行防抖处理，确保信号稳定可靠。

​	2.	**模式控制模块**

​	•	通过 enter 和 confirm 信号进入模式，exit 信号退出模式，控制 type_entered 信号。

​	3.	**多步运算模块**

​	•	分 4 个步骤执行 in1 和 in2 的按位乘法运算，结果逐步累加并输出到 LED。

​	4.	**数码管动态显示模块**

​	•	将输入的 in1 和 in2 转换为 7 段数码管显示编码，实现动态刷新显示。

​	5.	**结果显示模块**

​	•	LED 实时显示当前计算结果，未进入模式时保持清零状态。

| **状态** | **描述**                                                |
| -------- | ------------------------------------------------------- |
| `S0`     | **初始化**：清零结果 `result`，显示清空 `leds`。        |
| `S1`     | **步骤 1**：计算 `result = result + in1 * in2[0]`。     |
| `S2`     | **步骤 2**：计算 `result = result + in1 * in2[1] * 2`。 |
| `S3`     | **步骤 3**：计算 `result = result + in1 * in2[2] * 4`。 |

competition_top:

​	1.	set **子模块**

​	•	设置比赛参数，如题目类型、选手数量等。

​	•	输出赛题信息和参赛选手数量。

​	2.	answer **子模块**

​	•	管理答题逻辑，包括题目计时、答案输入与验证。

​	•	存储选手答题记录并实时显示答题状态。

​	3.	review **子模块**

​	•	回顾比赛结果，支持查看选手答题统计。

​	•	动态显示答题结果的统计信息。

​	4.	**数码管扫描显示**

​	•	动态分时复用显示数码管内容。

​	•	支持实时显示当前模式、题目编号等信息。

​	5.	**模式切换逻辑**

​	•	实现 mode1（设置）、mode2（答题）、mode3（回顾）三模式切换。

​	•	按键切换，循环更新模式。

​	6.	**按键延时去抖**

​	•	通过计时器稳定按键信号，避免按键抖动干扰。

​	7.	**数码管动态输出**

​	•	根据当前模式切换数码管显示内容，显示状态或结果。

| **状态**          | **描述**                                                     |
| ----------------- | ------------------------------------------------------------ |
| `mode_entered=0`  | 未进入模式，显示当前模式编号，等待确认进入模式。             |
| `mode_entered=1`  | 进入模式，激活具体模式的子模块（`set`, `answer`, `review`），等待执行具体操作。 |
| `mode_entered2=1` | 子模块已进入，子模块开始工作，数码管和LED动态显示子模块输出内容。 |
| `select`          | 切换模式信号，改变当前模式 `mode_sel`，在 `mode1 -> mode2 -> mode3 -> mode1` 循环切换。 |
| `confirm`         | 确认进入模式或激活子模块的信号。                             |
| `exit`            | 退出当前模式或子模块，回到初始状态，复位模式状态。           |
| `delay_trigger=1` | 按键触发延时完成，避免按键抖动信号干扰。                     |

answer:

​	1.	**赛题数据管理模块**

​	•	通过 mode_question_flat 信号将50个赛题数据解码到 question 数组中存储，同时支持二维数组的展平与重构操作，将选手的答题结果存储在展平的 player_flat 中，用于后续分析。

​	2.	**计时管理模块**

​	•	current_time 倒计时逻辑，确保每个选手的答题时间限制，并结合 delay_trigger2 实现秒级计时。超时情况下设置 timelimit 标志。

​	3.	**题目切换与选手切换模块**

​	•	管理当前赛题 current 和当前选手 current_player 的动态切换。完成当前题目后自动切换到下一题，最后一题完成后切换到下一个选手。

​	4.	**答题输入处理模块**

​	•	管理答题输入的多阶段处理，依据题目类型动态解析答题数据并存储于选手数据表 player 中。

​	•	使用 input_counter 标志区分题目输入的不同阶段。

​	5.	**数码管显示模块**

​	•	使用多个数码管显示当前题目编号、题目类型、倒计时、输入提示等信息。

​	6.	**验证模块**

​	•	提供对选手答案的验证功能，基于任务类型调用不同操作（如进制转换、有符号运算、位移、逻辑操作等），并与题目正确答案进行比对，设置 check 标志。

​	7.	**任务操作模块**

​	•	根据题目类型执行不同的操作，包括：

​	•	**进制转换** (convert_binary)

​	•	**有符号运算** (signed_operation)

​	•	**位移操作** (shift_operation)

​	•	**按位运算** (bitwise_operation)

​	•	**逻辑运算** (logic_operation)

| **状态**         | **描述**                                                     |
| ---------------- | ------------------------------------------------------------ |
| `mode_entered=1` | 进入答题模式，允许选手进行答题操作，题目信息和计时在数码管中显示。 |
| `mode_entered=0` | 退出答题模式，重置数码管与 LED 输出，停止倒计时。            |
| `finish=1`       | 当前选手答题结束，等待提交或超时切换到下一题或选手。         |
| `timelimit=1`    | 答题超时，自动标记答案无效。                                 |
| `submit`         | 提交当前选手的答题结果，进入下一题或下一选手的答题流程。     |
| `current_time`   | 倒计时状态，倒计时结束后自动切换题目或选手，更新显示信息。   |
| `current_player` | 当前答题选手，管理答题的多选手循环流程。                     |
| `current`        | 当前答题赛题编号，支持赛题编号的循环管理。                   |
| `input_counter`  | 记录当前题目的输入阶段，用于多阶段输入的题目类型。           |
| `check`          | 验证选手答案的正确性，根据题目类型调用对应的验证任务（如进制转换验证）。 |

set:

​	1.	**模块功能**

该模块用于设置比赛模式的题目，包括模式切换、操作符选择、操作数输入等功能，输出展平后的赛题数组和题目数量。

​	2.	**主要功能点**

​	•	**模式切换**：支持6种运算模式（进制转换、加减法、移位、位运算、逻辑运算、自定义模式）。

​	•	**操作符选择**：每种运算模式可切换不同的操作符，选择适合题目的操作。

​	•	**操作数输入**：支持输入两个操作数（A和B），并存储到题目数组中。

​	•	**动态数码管显示**：显示当前模式、操作符及输入的数值。

​	•	**题目计数**：根据输入逐步更新题目总数，并展平题目数据输出。

​	3.	**输入说明**

​	•	confirm：确定输入。

​	•	select：切换模式或操作符。

​	•	in：拨码开关输入，用于输入操作数。

​	•	enter：进入设置模式。

​	4.	**输出说明**

​	•	mode_question_flat：展平的赛题数组，用于输出给其他模块。

​	•	total：当前题目总数。

​	•	seg1~seg8：数码管动态显示当前模式、操作符及输入的数值。

| 步骤编号 | 状态描述           | 条件                       | 操作                                                         |
| -------- | ------------------ | -------------------------- | ------------------------------------------------------------ |
| Step1    | 模式未进入         | `confirm && delay_trigger` | 进入模式，`mode_entered <= 1`                                |
| Step2    | 模式切换显示操作符 | `select && delay_trigger`  | 根据操作符切换（`op` 参数化切换顺序：`OP1->OP2->...->OP4->OP1`） |
| Step3    | 存储操作数A        | `confirm && delay_trigger` | 显示并存储输入的数值到 `mode_question[total]`                |
| Step4    | 存储操作数B        | `confirm && delay_trigger` | 根据模式存储第二操作数并更新题目数据                         |
| Step5    | 设置完成           | `exit && delay_trigger`    | 完成模式设置，退出模式，`mode_entered <= 0`                  |

review:

​	1.	**模块功能**

review 模块用于展示选手的答题记录、题目信息以及最终比赛结果。支持切换选手、查看具体题目详情，以及比较选手的答题情况。

​	2.	**主要功能点**

​	•	**选手得分计算**：根据选手的答题正确数和时间，计算最终得分并找出获胜者。

​	•	**题目详情展示**：支持查看具体题目信息、选手答案和正确答案。

​	•	**动态显示切换**：使用数码管和 LED 动态显示模式、选手、题目信息、正确答案等内容。

​	•	**胜者判定**：基于选手得分和答题时间的规则，判定比赛胜者。

​	3.	**输入说明**

​	•	confirm：确认按钮，用于切换步骤。

​	•	select：切换按钮，用于切换模式、选手或者答案。

​	•	select_answer：用于选择是否查看正确答案。

​	•	player_flat 和 mode_question_flat：存储展开的选手答题数据和题目信息。

​	•	in：输入值，用于选手或题目编号选择。

​	4.	**输出说明**

​	•	seg1~seg8：数码管动态显示模式、题目编号、选手分数及时间等信息。

​	•	led1 和 led2：显示选手答案、正确答案或者题目信息。

​	•	type_entered：标志是否进入查看模式。

​	5.	**子功能说明**

​	•	**得分计算**：遍历选手答题记录，累计正确题目数和总答题时间。

​	•	**正确答案计算**：根据题目信息，调用不同的任务（如 convert_binary、signed_operation 等）计算正确答案。

​	•	**胜者判定**：通过比较正确题目数和答题时间，找出得分最高的选手。

​	•	**动态显示**：根据步骤显示不同的选手或题目信息。

| 步骤编号 | 状态描述                   | 条件                             | 操作                                              |
| -------- | -------------------------- | -------------------------------- | ------------------------------------------------- |
| Step1    | 初始化                     | `reset`                          | 清空 `score` 和相关存储变量，显示模式             |
| Step2    | 查看选手信息               | `confirm && delay_trigger`       | 根据 `player` 显示选手的答题结果                  |
| Step3    | 查看具体题目详情           | `confirm && delay_trigger`       | 根据 `question` 和模式显示具体题目信息            |
| Step4    | 查看题目答案及选手得分详情 | `select_answer && delay_trigger` | 根据 `select_answer` 切换显示正确答案或者选手答案 |
| Step5    | 胜者展示模式               | `store == Step5`                 | 根据得分和答题时间，显示胜者以及选手详细得分      |

## bonus实现说明

### 计算演示模式

拨码开关的2-4位输入数字a，拨码开关的6-8位输入数字b；

输入完后按确定键，两个数字会在上方数码管上显示；

led灯依次显示乘法操作中每次累加的结果，每个步骤停留3秒，得到最终答案后停留不动；

演示完毕后可以进行下次乘法演示或退回到待机模式。

### 使用拨码开关、按键开关以外的输入设备

使用dip开关调节蜂鸣器音量。

### 使用7段数码管、led以外的输出设备

外接耳机连接在3.5mm耳机接口上，可以听到蜂鸣器的音效；

设计了多种音效：正确音效，错误音效，结算音效，模式切换音效，提示音效；在用户进行操作时自动播放提示。

## 项目总结

在本次项目开发中，我们团队围绕“程序员入门计算学习机”这一主题，完成了从功能设计到模块实现、集成和测试的全过程。项目设计内容包括计算模式、学习模式、竞赛模式和计算演示模式等多个模块，这些模块均基于拨码开关、数码管、LED和蜂鸣器等硬件资源实现。

但是，我们在与其他小组交流的过程中发现，如果外接部份设备，比如显示器或者键盘，能够将拨码开关、led、数码管这些器件的输入输出任务减少，这样复合的逻辑相对不会那么复杂；而我们就只用手头上的这些器件来完成几乎整个功能，不管怎么说，这个可能也算很不可思议的，需要状态转换器里面套状态转换器，尤其在竞赛模式中特别折磨。

我们实际上也尝试过用单片机薄膜矩阵键盘来接到通用io接口上，来进行第二种方式的数字输入，但是这个买的3块钱的键盘实在不行，插上去抖动一下他对应的输入数据都会改变；并且我们出于好奇，尝试了直接用手或者用金属导体去触碰io开关，结果这个得到的输入数据也会有意想不到的结构。这可能就是硬件带来的小小震撼吧，一切都只有上板操作后才知道到底对不对。

团队合作很愉快，有两个硬件语言大神（真），而且我们就在隔壁寝室，拿开发版调试很方便；问了另外一组的同学，她们不在一处，测试就很麻烦，写了testbench测试能过，但是实际上板了有很多问题；所以这个也很幸运，我们testbench一点都没写，上板才是检验真理的唯一标准（笑）。

通过这次的开发经历，我们锻炼了verilog代码以及工程设计能力，是一次宝贵的经历。

## project建议：**商品选购模拟器**

#### **功能需求**

1. **系统初始化**

   - 系统上电或按下reset

     按钮后进入初始化状态：

     - 所有数码管显示为 `0`。
     - LED灯全灭。
     - 商品和支付信息清零。

2. **购物模式**

   - 管理员可以通过拨码开关选择商品编号（假设支持编号1~8的商品）。
   - 每次选择商品后按下确认按钮，系统记录商品编号和价格。
     - 每件商品对应固定价格，例如商品1价格为10元，商品2价格为15元，做好记录存储。
   - 数码管动态显示当前选择的商品编号及总价。
   - 每次添加商品后，LED灯逐渐亮起，表示购物篮的容量，最多支持8件商品。（可以由管理员设定）
   - 输入当前用户的信息，如编号和金额。

3. **结算模式**

   - 按下“结算”按钮进入结算模式：
     - 数码管显示总金额与剩余金额。
     - LED灯闪烁，提示用户进行支付。
   - 用户通过拨码开关输入支付金额，并按下确认按钮完成支付。
     - 如果支付金额不足，数码管显示欠款金额。
     - 如果支付金额足够，系统找零并返回主菜单。
   - 完成购物后，可以查看所有购得的商品的金额，折扣情况；并显示总金额

4. **优惠模式**

   - 每次进入结算模式时随机触发优惠活动（随机可能需要是确定的概率触发）：
     - 例如，满50减10、满100减30等。
     - 数码管显示优惠后的价格。
   - 若用户满足活动条件，LED灯以不同的频率闪烁提醒。
   - 完成购物后，可以查看所有购得的商品的金额，折扣情况；并显示总金额

5. **抢购模式**

   - 进入抢购模式

     - 在管理员模式下，设置某一商品（例如编号3）为抢购商品。
     - 系统提前5秒进入抢购倒计时，数码管动态显示倒计时（5、4、3、2、1）。
     - LED灯以逐渐加快的频率闪烁提示用户抢购即将结束。

   - 抢购规则

     - 抢购模式下，目标商品享受超低折扣（例如商品价格减半或仅1元，可以在管理员模式内设置）。
     - 用户需在倒计时结束前，通过拨码开关输入商品编号并按确认按钮完成抢购。
     - 如果用户在倒计时内成功确认，则系统记录抢购成功信息并切换回购物模式。
     - 如果用户未能在倒计时内完成抢购操作，则显示“抢购失败”，LED灯快速闪烁3次后退出抢购模式。

   - 抢购成功奖励

     - LED灯点亮特定模式（如追逐效果）表示抢购成功。
     - 数码管显示“抢购成功”及折扣后的价格。

     完成购物后，可以查看所有购得的商品的金额，折扣情况；并显示总金额

6. **管理员模式**（体现在之前的模式里）

   - 按下特定组合键（如长按“结算”按钮）进入管理员模式：
     - 设置商品价格。
     - 开启或关闭抢购模式并选择抢购商品编号。
   - 可以在任何阶段进行商品设置（进货），如果在抢购模式中设置，那么抢购中的记时需要先暂停。

------

#### **评分标准**

1. **功能实现（80分）**
   - 系统初始化（10分）
   - 商品选择与价格计算（20分）
   - 结算逻辑（20分）
   - 优惠活动（10分）
   - 抢购模式（20分）
2. **系统优化（15分）**
   - LED灯动态效果设计（5分）
   - 抢购模式逻辑的灵活性（5分）
   - 系统模块化设计与代码规范（5分）
3. **附加分（5分）**
   - 增加多个抢购商品或支持多人抢购
   - 可以通过计算得出，如何花光所有钱（0-1背包问题）
   - 可以实现账号密码管理，在付费时需要判断密码是否正确；在输入密码错误3次后会有冷却时间
   - 设计额外的输入和输出，更好模拟与提示购物的过程
